class <%= @migration_class_name %> < ActiveRecord::Migration[5.0]
  def up
    execute <<-SQL
<%= inject_sql("logidze_version.sql") %>
<%= inject_sql("logidze_snapshot.sql") %>
<%= inject_sql("logidze_exclude_keys.sql") %>
<%= inject_sql("logidze_compact_history.sql") %>
<%= inject_sql("logidze_logger.sql") %>
    SQL
  end

  def down
    <%- unless update? -%>
    execute <<~SQL
      DROP FUNCTION logidze_version(bigint, jsonb, timestamp with time zone, text[]) CASCADE;
      DROP FUNCTION logidze_exclude_keys(jsonb, text[]) CASCADE;
      DROP FUNCTION logidze_compact_history(jsonb) CASCADE;
      DROP FUNCTION logidze_snapshot(jsonb, text, text[]) CASCADE;
      DROP FUNCTION logidze_logger() CASCADE;
    SQL
    <%- end -%>
  end
end
